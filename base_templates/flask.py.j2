#!/usr/bin/exec-suid -- /usr/bin/python3 -I

{%- set challenge = namespace(var=None) -%}
{%- set challenge.reset_uid = False -%}
{%- set challenge.reset_path = False -%}
{%- set challenge.reset_flask_host = "" -%}
{%- set challenge.flask_port = 80 -%}

{% block setup %}
{% endblock %}

{% block imports %}
{% endblock %}
import flask
import os

app = flask.Flask(__name__)

{% block handlers %}
{% endblock %}
{% block initialization %}
{% endblock %}

{% if challenge.reset_uid %}
os.setuid(os.geteuid())
{%- endif %}
{%- if challenge.reset_path %}
os.environ["PATH"] = "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
{%- endif %}
app.secret_key = os.urandom(8)
{%- if challenge.flask_host %}
app.config['SERVER_NAME'] = "{{challenge.flask_host}}:{{challenge.flask_port or 80}}"
{%- endif %}
app.run({%block run_host%}"{{challenge.flask_host or "0.0.0.0"}}"{%endblock%}, {{challenge.flask_port}})
