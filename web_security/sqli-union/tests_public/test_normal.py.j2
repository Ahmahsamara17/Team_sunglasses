#!/usr/bin/env python3

import subprocess
import requests
import atexit
import time

proc = subprocess.Popen(['/challenge/server'])
atexit.register(lambda: (proc.terminate(), proc.wait()))
time.sleep(1)  # Give it time to start

# Test normal query
response = requests.get(
    "http://challenge.localhost/",
    params={"query": "admin"}
)
assert response.status_code == 200
assert "admin" in response.text

# Test wildcard query
response = requests.get(
    "http://challenge.localhost/",
    params={"query": "%"}
)
assert response.status_code == 200
assert "admin" in response.text or "guest" in response.text

print("Normal functionality tests passed")