{%- extends "base_templates/flask.py.j2" -%}

{% block setup %}
  {{- super() -}}
  {%- from 'base_templates/random_names.j2' import generate_names -%}
  {{- generate_names(challenge, random) -}}
  {%- set challenge.flask_host = "challenge.localhost" -%}
  {%- set challenge.service_name = "pwnmsg" -%}
  {%- set challenge.msg_in_textarea = False -%}
  {%- set challenge.parameter_message = "msg" -%}
{% endblock %}

{% block handlers %}
@app.route("/{{challenge.endpoint_challenge}}", methods=["GET"])
def challenge_get():
    return f"""
        <html><body>
        <h1>{{challenge.service_name}} ephemeral message service</h1>
        The message:
        {%- if challenge.msg_in_textarea %}
        <form>
            <textarea name={{challenge.parameter_message}}>{{"{" + 'flask.request.args.get("' + challenge.parameter_message + '", "Type your message here!")' + "}"}}</textarea>
            <input type=submit value="Make URL!">
        </form>
        {%- else %}
        {{"{" + 'flask.request.args.get("' + challenge.parameter_message + '", "(none)")' + "}"}}
        <hr>
        <form>
            Craft a message:
            <input type=text name={{challenge.parameter_message}}>
            <input type=submit value="Make URL!">
        </form>
        {%- endif %}
        </body></html>
    """
{% endblock %}
